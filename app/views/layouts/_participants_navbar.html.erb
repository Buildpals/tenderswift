<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <%= link_to '#', class: 'navbar-brand' do %>
      <%= cl_image_tag(@participant.project_owners_company_logo.full_public_id,
                       format: 'jpg', height: 28, crop: :scale,
                       style: 'height: 28px; margin-top: 0px;',
                       title: @participant.project_owners_company_name,
                       alt: @participant.project_owners_company_name)
      %>
      <%= @participant.project_owners_company_name %>
  <% end %>


  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>


  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav ml-auto">
      <% if @participant.status.in? %w(guest not_read read participating) %>
          <li class="nav-item mr-3">
            <%= link_to @participant.status.in?(%w(participating)) ? 'Exit tender process' : 'Decline invitation', @participant.decline_url,
                        class: 'btn btn-link',
                        data: {confirm: 'Declining this project means you will no longer be participating in tendering for this project. Are you sure you want to do so?'} %>
          </li>
      <% end %>

      <% if @participant.status.in? %w(guest not_read read not_participating) %>
          <li class="nav-item mr-3">
            <% link_to 'Purchase Tender Documents', @participant.accept_url,
                        class: 'btn btn-secondary' %>
            <button class="btn btn-secondary btn-payment-modal" data-toggle="modal" data-target="#paymentModal"> Purchase Tender Documents for GHC <%= @participant.request_for_tender.selling_price %></button>
          </li>
      <% end %>
    </ul>
  </div>


  <% if @participant.status.in? %w(participating) %>
      <%= form_with(model: @participant, local: true, class: 'form-inline') do |form| %>
          <%= form.text_field :status, value: 'bid_made', id: :participant_phone_number, type: 'hidden' %>
          <%= form.text_field :bid_submission_time, value: Time.current, id: :participant_phone_number, type: 'hidden' %>
          <%= form.submit 'Submit Bid', data: {confirm: 'You cannot edit the Bill of Quantities after submitting your bid. Are you sure you want to submit your bid?'},
                          class: 'btn btn-secondary my-2 my-sm-0 submit-your-bid' %>
      <% end %>
  <% end %>

  <% if @participant.status.in? %w(bid_made) %>
      Bid submitted successfully
  <% end %>
</nav>

<div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Make Payment Of Tender Documents</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <%= form_with model: TenderTransaction.new, local: true, class: 'form-inline' do |form| %>
          <%= form.label 'Mode Of Payment:', class: 'col-md-6' %>
          <%= form.select :network_code, {'AIRTEL Money': 'AIR', 'MTN Mobile Money': 'MTN', 'TIGO CASH': 'TIG', 'VISA/ MASTER CARD': 'CRD', 'Vodafone Cash': 'VOD' }, {},
                          { id: :participant_tender_transaction_network_code, class: 'form-control col-md-6 network-select' } %>
          <br/>
          <br/>
          <%= form.label 'Mobile Money Number:', class: 'col-md-6 mobile-money-number'%>
          <%= form.text_field :customer_number, id: :participant_tender_transaction_customer_number, class: 'form-control col-md-6 mobile-money-number' %>
          <br/>
          <br/>
          <%= form.label 'Voucher Code:', class: 'col-md-6 voucher-code' %>
          <%= form.text_field :voucher_code, id: :participant_tender_transaction_voucher_code, class: 'form-control col-md-6 voucher-code' %>
          <br/>
          <br/>
          <%= form.text_field :request_for_tender_id, value: @participant.request_for_tender.id, id: :participant_tender_transaction_request_for_tender_id, type: 'hidden' %>
          <%= form.text_field :participant_id, value: @participant.id, id: :participant_tender_transaction_participant_id, type: 'hidden' %>
          <%= form.text_field :status, value: 'pending', id: :participant_tender_transaction_status, type: 'hidden' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <%= submit_tag 'Make Payment', class: 'btn btn-primary' %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready( function (e) {
      $('.voucher-code').each( function (index, element) {
          $(this).css('display', 'none');
      });
      $('.mobile-money-number').each( function (index, element) {
          $(this).css('display', 'inherit');
      });

      $('.network-select').change( function (e) {
         if($('.network-select').val() == 'VOD'){
             $('.voucher-code').each( function (index, element) {
                 $(this).css('display', 'inherit');
             });
             $('.mobile-money-number').each( function (index, element) {
                 $(this).css('display', 'inherit');
             });
         }
         else if($('.network-select').val() == 'CRD'){
             $('.voucher-code').each( function (index, element) {
                 $(this).css('display', 'none');
             });
             $('.mobile-money-number').each( function (index, element) {
                 $(this).css('display', 'none');
             });
         }
         else{
             $('.voucher-code').each( function (index, element) {
                 $(this).css('display', 'none');
             });
             $('.mobile-money-number').each( function (index, element) {
                 $(this).css('display', 'inherit');
             });
         }
      });

  });

</script>