<head>
  <meta charset="utf-8">

  <!--Google optimize stuff-->
  <style>.async-hide {
    opacity: 0 !important
  } </style>
  <script>(function (a, s, y, n, c, h, i, d, e) {
    s.className += ' ' + y
    h.start = 1 * new Date
    h.end = i = function () {s.className = s.className.replace(RegExp(' ?' + y), '')};
    (a[n] = a[n] || []).hide = h
    setTimeout(function () {
      i()
      h.end = null
    }, c)
    h.timeout = c
  })(window, document.documentElement, 'async-hide', 'dataLayer', 4000,
    {'GTM-52F9XZL': true})</script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123912721-1"></script>
  <script>
    window.dataLayer = window.dataLayer || []

    function gtag () {dataLayer.push(arguments)}

    document.addEventListener('turbolinks:load', function (event) {
      if (typeof gtag === 'function') {
        gtag('js', new Date())
        gtag('config', 'UA-123912721-1', {
          'optimize_id': 'GTM-52F9XZL',
          'page_location': event.data.url
        })
        gtag('config', 'AW-785330278')
      }
    })
  </script>

  <!-- Event snippet for Publish a request for tender conversion page
  In your html page, add the snippet and call gtag_report_conversion when someone clicks on the chosen link or button. -->
  <script>
    function gtag_report_conversion (url) {
      var callback = function () {
        if (typeof(url) != 'undefined') {
          window.location = url
        }
      }
      gtag('event', 'conversion', {
        'send_to': 'AW-785330278/E3KKCN_viYwBEObgvPYC',
        'transaction_id': '',
        'event_callback': callback
      })
      return false
    }
  </script>


  <title>
    <% if content_for :title %>
      <%= yield :title %>
    <% else %>
      TenderSwift
    <% end %>
  </title>
  <%= csrf_meta_tags %>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme-color" content="#2b3f57"/>

  <% if content_for :favicon %>
    <%= yield :favicon %>
  <% else %>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/tenderswift/image/upload/c_scale,h_32/v1520935594/tenderswift-logo-square-inverse.png">
  <% end %>

  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  <%= javascript_pack_tag 'hello_vue' %>
  <%= stylesheet_pack_tag 'hello_vue' %>
  <%= action_cable_meta_tag %>

  <% if ENV['BUILDPALS_SERVER_NAME'] == 'production_server' %>
    <!--Smartlook script-->
    <script type="text/javascript">
      if (location.host === 'www.tenderswift.com'
        || location.host === 'app.tenderswift.com'
        || location.host === 'public.tenderswift.com') {

        window.smartlook || (function (d) {
          var o = smartlook = function () { o.api.push(arguments)},
            h = d.getElementsByTagName('head')[0]
          var c = d.createElement('script')
          o.api = new Array()
          c.async = true
          c.type = 'text/javascript'
          c.charset = 'utf-8'
          c.src = 'https://rec.smartlook.com/recorder.js'
          h.appendChild(c)
        })(document)
        smartlook('init', 'c47c61b375c91f4ae65a7a550f8feb1fbf8a1ea9')

        smartlook('identify', <%= current_publisher&.id %>, {
          'name': "<%= current_publisher&.company_name %>",
          'email': "<%= current_publisher&.email %>"
        })

        // Send push notification that a new user has arrived with the users session url.
        smartlook(
          function () {
            if (!sessionStorage.alreadySentPushNotification) {
              sendPushNotification()
              sessionStorage.alreadySentPushNotification = 1
            }
          }
        )

        function sendPushNotification () {
          var xhr = new XMLHttpRequest()
          xhr.open('POST', 'https://api.pushbullet.com/v2/pushes', true)
          xhr.setRequestHeader('Content-Type', 'application/json')
          xhr.setRequestHeader('Access-Token', 'o.L3ObKyzGH7m4ADEYdtBlOfAKP7R9Wr5e')
          xhr.send(JSON.stringify({
            type: 'note',
            title: 'New session started by visitor',
            body: `View this session on smartlook here ${smartlook.playUrl}`,
            channel_tag: 'tenderswiftisthegreatestapponearth'
          }))
          xhr.onload = function () {
            var data = JSON.parse(this.responseText)
            console.log(data)
          }
        }

      }
    </script>
    <!--#smartlook script-->

    <!-- Hotjar Tracking Code for www.tenderswift.com -->
    <script>
      if (location.host === 'www.tenderswift.com'
        || location.host === 'app.tenderswift.com'
        || location.host === 'public.tenderswift.com') {

        (function (h, o, t, j, a, r) {
          h.hj = h.hj || function () {(h.hj.q = h.hj.q || []).push(arguments)}
          h._hjSettings = {hjid: 1068666, hjsv: 6}
          a = o.getElementsByTagName('head')[0]
          r = o.createElement('script')
          r.async = 1
          r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv
          a.appendChild(r)
        })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=')

      }
    </script>
  <% end %>
</head>