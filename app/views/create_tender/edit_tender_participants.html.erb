<%= form_with model: @request,
              scope: :request_for_tender,
              url: update_tender_participants_path(@request),
              method: :patch,
              id: 'request-form' do |form| %>

    <p class="text-muted small">
      Add the contact information of all contractors you are inviting to bid on this project.
    </p>

    <div class="form-group mt-3">
      <ul class="list-group list-group-flush nested-forms">
        <%= form.fields_for :participants do |participant| %>
            <%= render 'participant_fields', f: participant %>
        <% end %>
        <li class="d-flex w-100 justify-content-between">
          <%= link_to_add_association 'Add another participant', form, :participants, class: 'btn btn-sm btn-block btn-primary my-1' %>
        </li>
      </ul>
    </div>

<% end %>


<div class="d-flex w-100 justify-content-end">
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-info w-50" data-toggle="modal" data-target="#preview-modal">
    Preview
  </button>

  <%= link_to 'Send to participants',
              email_request_for_tender_path(request),
              class: 'btn btn-secondary ml-2',
              data: {confirm: 'Send out this request for tender means all listed participants will immediately have access to this particular Request For Tender and as a result can start placing their bids. Are you sure you want to do so?'} %>

</div>



<!-- Modal -->
<div class="modal fade" id="preview-modal" tabindex="-1" role="dialog" aria-labelledby="preview-modal-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="preview-modal-label">
          Preview request before sending out
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <strong>Preview the invitation email</strong>
        <div class="mb-2">
          When you click the 'Send to participants' button, an email similar to this, will be sent to all the participating contractors
        </div>

        <div class="d-flex w-100 justify-content-end mb-2">
          <button type="button" class="btn btn-sm btn-primary"
                  data-toggle="modal" data-target="#email-modal" data-dismiss="modal">
            Preview invitation email
          </button>
        </div>

        <hr>

        <strong>Open the contractor view</strong>
        <div class="mb-2">
          Preview what the contractor will see when they open the invitation email. <br>
          Check that the project information, bill of quantities, documents and questionnaire is exactly as you want it.
        </div>

        <div class="d-flex w-100 justify-content-end mb-2">
          <a href="<%= participants_project_information_path(@participant) %>" target="_blank" class="btn btn-sm btn-primary">
            Open contractor view
          </a>
        </div>

      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="email-modal" tabindex="-1" role="dialog" aria-labelledby="email-modal-label" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="email-modal-label">
          Email Preview
        </h5>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="height: 500px; overflow: scroll">
        <%= render 'participant_mailer/participant_email_template', participant: @participant %>
      </div>
    </div>
  </div>
</div>